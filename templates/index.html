<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Casino 7-24 VIP</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <style>
        body { font-family: sans-serif; background: #0f0f0f; color: white; display: flex; height: 100vh; margin: 0; }
        #side-panel { width: 200px; background: #1a1a1a; border-right: 2px solid #ff4500; padding: 15px; }
        #main { flex: 1; display: flex; flex-direction: column; align-items: center; padding: 10px; }
        .v-box { width: 45%; height: 250px; background: #000; border: 2px solid #ff4500; border-radius: 10px; }
        #chat-area { width: 90%; height: 200px; background: #1e1e1e; overflow-y: auto; padding: 10px; border-radius: 5px; margin: 10px 0; border: 1px solid #333; }
        .user-item { padding: 8px; cursor: pointer; border-bottom: 1px solid #222; font-size: 14px; }
        .user-item:hover { color: #ff4500; }
        .controls { display: flex; gap: 10px; margin-bottom: 10px; }
        button { padding: 8px 15px; border-radius: 5px; border: none; cursor: pointer; font-weight: bold; }
        .btn-call { background: #28a745; color: white; }
        .btn-cancel { background: #dc3545; color: white; }
        input { padding: 10px; width: 60%; border-radius: 5px; border: none; }
    </style>
</head>
<body>
    <div id="side-panel">
        <h3>ğŸ‘¥ Ãœyeler</h3>
        <div id="user-list">BaÄŸlanÄ±yor...</div>
    </div>

    <div id="main">
        <h3 id="target-title">ğŸ° Genel Sohbet</h3>
        <div style="display: flex; width: 100%; justify-content: center; gap: 10px;">
            <video class="v-box" id="localVideo" autoplay playsinline muted></video>
            <video class="v-box" id="remoteVideo" autoplay playsinline></video>
        </div>

        <div class="controls" id="call-buttons" style="display:none;">
            <button class="btn-call" onclick="callUser()">ğŸ“ Arama Ä°steÄŸi GÃ¶nder</button>
            <button class="btn-cancel" onclick="cancelCall()">âœ– Ä°ptal Et</button>
        </div>

        <div id="chat-area"></div>
        
        <div style="width: 100%; text-align: center;">
            <input type="text" id="msg-input" placeholder="Mesaj yazÄ±n (Enter)...">
            <button onclick="send()" style="background:#ff4500; color:white;">GÃ¶nder</button>
        </div>
    </div>

    <script>
        const socket = io();
        let myName = prompt("Ä°sminiz:");
        let selectedUser = ""; // BoÅŸsa genel sohbet

        if(myName) socket.emit('register', myName);

        // Kamera BaÅŸlat
        navigator.mediaDevices.getUserMedia({video: true, audio: true})
            .then(s => { document.getElementById('localVideo').srcObject = s; });

        function send() {
            const input = document.getElementById('msg-input');
            const msg = input.value;
            if(!msg) return;

            if(selectedUser) {
                socket.emit('send_private_event', {target: selectedUser, message: msg, type: 'private'});
            } else {
                socket.emit('send_global_msg', {message: msg});
            }
            input.value = "";
        }

        document.getElementById('msg-input').onkeypress = e => { if(e.key==='Enter') send(); };

        function callUser() {
            socket.emit('send_private_event', {target: selectedUser, type: 'call_req'});
            addMsg("Sistem", `Siz ${selectedUser} kiÅŸisine arama isteÄŸi gÃ¶nderdiniz.`, "yellow");
        }

        function cancelCall() {
            socket.emit('send_private_event', {target: selectedUser, type: 'call_cancel'});
            addMsg("Sistem", "Arama iptal edildi.", "red");
        }

        socket.on('update_user_list', list => {
            const div = document.getElementById('user-list');
            div.innerHTML = "<div class='user-item' onclick='selectGenel()'>ğŸŒ Genel Sohbet</div>";
            list.forEach(u => {
                if(u !== myName) {
                    const item = document.createElement('div');
                    item.className = "user-item";
                    item.innerText = u;
                    item.onclick = () => { 
                        selectedUser = u; 
                        document.getElementById('target-title').innerText = "ğŸ‘¤ Ã–zel: " + u;
                        document.getElementById('call-buttons').style.display = "flex";
                    };
                    div.appendChild(item);
                }
            });
        });

        function selectGenel() {
            selectedUser = "";
            document.getElementById('target-title').innerText = "ğŸ° Genel Sohbet";
            document.getElementById('call-buttons').style.display = "none";
        }

        socket.on('receive_msg', data => {
            let color = data.type === 'global' ? 'white' : '#ff4500';
            if(data.type === 'call_req') {
                if(confirm(data.sender + " sizinle gÃ¶rÃ¼ntÃ¼lÃ¼ konuÅŸmak istiyor. Kabul mÃ¼?")) {
                    alert("Arama kabul edildi (WebRTC baÄŸlantÄ±sÄ± baÅŸlÄ±yor...)");
                }
            } else if(data.type === 'call_cancel') {
                alert(data.sender + " aramayÄ± iptal etti.");
            } else {
                addMsg(data.sender, data.message, color);
            }
        });

        function addMsg(s, m, c) {
            const area = document.getElementById('chat-area');
            area.innerHTML += `<div style="color:${c}"><b>${s}:</b> ${m}</div>`;
            area.scrollTop = area.scrollHeight;
        }
    </script>
</body>
</html>
