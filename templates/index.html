<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Casino 7-24 Canlƒ± Sohbet</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <style>
        body { font-family: Arial, sans-serif; background: #1a1a1a; color: white; text-align: center; }
        .video-container { display: flex; justify-content: center; gap: 10px; margin-top: 20px; flex-wrap: wrap; }
        video { width: 45%; max-width: 400px; border: 3px solid #ff4500; border-radius: 15px; background: black; }
        .controls { margin-top: 20px; }
        button { padding: 12px 25px; margin: 5px; font-size: 16px; border-radius: 8px; cursor: pointer; border: none; font-weight: bold; }
        .btn-start { background: #28a745; color: white; }
        .btn-stop { background: #dc3545; color: white; }
        #chat-box { width: 80%; max-width: 600px; height: 150px; background: #333; margin: 20px auto; overflow-y: scroll; padding: 10px; border-radius: 10px; text-align: left; }
        .status { color: #ffcc00; font-weight: bold; }
    </style>
</head>
<body>
    <h2>üé∞ Casino 7-24 Canlƒ± G√∂r√ºnt√ºl√º Sohbet</h2>
    
    <div class="status">Aktif Kullanƒ±cƒ±lar: <span id="users">Y√ºkleniyor...</span></div>
    
    <div class="video-container">
        <video id="localVideo" autoplay playsinline muted></video>
        <video id="remoteVideo" autoplay playsinline></video>
    </div>

    <div class="controls">
        <button class="btn-start" onclick="startSearch()">üîç Yeni Biriyle E≈üle≈ü</button>
        <button class="btn-stop" onclick="stopSearch()">üõë Aramayƒ± ƒ∞ptal Et / Kapat</button>
    </div>

    <div id="chat-box"><b>Sistem:</b> Ho≈ü geldiniz! Birini bulmak i√ßin butona basƒ±n.</div>

    <script>
        const socket = io();
        let localStream;
        let peerConnection;
        const config = { iceServers: [{ urls: 'stun:stun.l.google.com:19302' }] };

        // Kamerayƒ± A√ß
        async function initCamera() {
            try {
                localStream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
                document.getElementById('localVideo').srcObject = localStream;
            } catch (e) {
                alert("Kamera izni gerekli!");
            }
        }

        // Kullanƒ±cƒ± Listesi
        socket.on('user_list', (users) => {
            document.getElementById('users').innerText = users.join(', ');
        });

        function startSearch() {
            document.getElementById('chat-box').innerHTML += "<div><b>Sistem:</b> Yeni biri aranƒ±yor...</div>";
            socket.emit('find_match');
        }

        function stopSearch() {
            location.reload(); // En temiz iptal y√∂ntemi
        }

        // WebRTC Sinyalle≈üme Kodlarƒ± (Baƒülantƒ± ƒ∞√ßin)
        socket.on('signal', async (data) => {
            if (!peerConnection) startConnection(false);
            if (data.type === 'offer') {
                await peerConnection.setRemoteDescription(new RTCSessionDescription(data));
                const answer = await peerConnection.createAnswer();
                await peerConnection.setLocalDescription(answer);
                socket.emit('signal', answer);
            } else if (data.type === 'answer') {
                await peerConnection.setRemoteDescription(new RTCSessionDescription(data));
            } else if (data.candidate) {
                await peerConnection.addIceCandidate(new RTCIceCandidate(data.candidate));
            }
        });

        initCamera();
    </script>
</body>
</html>
